%table.table_book
  %tr
    %th Image
    %th= sortable 'title'
    %th= sortable 'author'
    %th= sortable 'rating'
    %th= sortable 'category'
    %th Status
    - if user.master?
      %th
    %th Reader
    - if user.master?
      %th Action
      %th Librarian
      %th Subscription
      %th Count of comments
  - books.each do |book|
    %tr.post-box{"data-item_id" => "#{book.id}"}
      %td
        - unless book.image.model[:image].nil?
          = image_tag(book.image.thumb.url, alt: 'Image')
        - else
          = image_tag('default_small.png', alt: 'No image')
      %td
        %h3= link_to book.title, book_path(book), class: 'list-group-item', 'data-search-term' => "#{book.title}"
      %td
        %h3 '#{book.author}'
      %td
        %div.stars(style = "--rating: #{book.rating};")
      %td
        = book.category.name
      %td{id: "#{book.id}"}
        - if book.status == true
          - unless book.subscriptions.empty?
            - if book.subscriptions.first.deleted_at.nil?
              %p Out
          - else
            %p Available
        - else book.status == false
          %p On restoration
      - if user.master?
        %td
          - unless book.subscriptions.empty?
            - unless book.subscriptions.first.deleted_at.nil?
              = check_box_tag :status, book.id, book.status, class: 'task-check'
          - else
            = check_box_tag :status, book.id, book.status, class: 'task-check'
      %td
        - unless book.subscriptions.empty?
          - if book.subscriptions.first.deleted_at.nil?
            %h4= book.subscriptions.first.user.name
      - if user.master?
        %td
          = link_to book_path(book), class: "btn-xs, btn-info like-link" do
            %i.far.fa-eye
          = link_to edit_book_path(book), class: "btn-xs, btn-info like-link" do
            %i.fas.fa-pencil-alt
          %i.far.fa-trash-alt.delete-link
        %td
          %h4= book.user.email
        %td
          %h4.sub_link
            = link_to 'Subscription', book_subscriptions_path(book), class: "btn-xs, btn-info like-link"
        %td
          %h4
            = pluralize(book.comments.count, "Comment")