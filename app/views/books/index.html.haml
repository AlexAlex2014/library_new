.container
  .row
    .col-md-12
      %h2 Books
      %p
        = link_to 'New book', new_book_path
  .row
    .col-md-12
      .panel-search
        %label Search:
        %input.live-search-box.form-control.input-sm{placeholder: ("search here"), type: "text"}
  .row
    %table.table_book
      %tr
        %th Image
        %th= sortable 'title'
        %th= sortable 'author'
        %th= sortable 'rating'
        %th= sortable 'status'
        - if @user.master?
          %th
        %th Reader
        - if @user.master?
          %th Action
          %th Librarian
          %th Subscription
      - @books.each do |book|
        %tr
          %td
            .post-box{"data-item_id" => "#{book.id}"}
              - unless book.image.nil?
                = image_tag(book.image.thumb.url, alt: 'Image')
              - else
                = image_tag('default.png', alt: 'No image')
          %td
            %h3= link_to book.title, book_path(book), class: 'list-group-item', 'data-search-term' => "#{book.title}"
          %td
            %h3 '#{book.author}'
          %td
            -#- @book_rating = rating(book)
            %div.stars(style = "--rating: #{book.rating};")
          %td{id: "#{book.id}"}
            - if book.status == true
              - unless book.subscriptions.empty?
                - if book.subscriptions.first.deleted_at.nil?
                  %p Out
              - else
                %p Available
            - else book.status == false
              %p On restoration
          - if @user.master?
            %td
              - unless book.subscriptions.empty?
                - unless book.subscriptions.first.deleted_at.nil?
                  = check_box_tag :status, book.id, book.status, class: 'task-check'
              - else
                = check_box_tag :status, book.id, book.status, class: 'task-check'
          %td
            - unless book.subscriptions.empty?
              - if book.subscriptions.first.deleted_at.nil?
                %h4= book.subscriptions.first.user.name # unless book.reader.nil?
          - if @user.master?
            %td
              = link_to book_path(book), class: "btn-xs, btn-info like-link" do
                %i.far.fa-eye
              = link_to edit_book_path(book), class: "btn-xs, btn-info like-link" do
                %i.fas.fa-pencil-alt
              = link_to book_path(book), method: :delete, data: { confirm: 'Are you sure?' } do
                %i.far.fa-trash-alt
            %td
              %h4= book.user.email
            %td.sub_link
              %h4
                = link_to 'Subscription', book_subscriptions_path(book), class: "btn-xs, btn-info like-link"
